# Fine-tuning configuration for ARC-AGI model
# This file can be modified for different experiment runs

# Test mode - set to true for quick test runs with only 128 rows of data.
test_run: true

# Environment - set true for Kaggle.
is_local: false

# Model save directory - overridden by MODEL_SAVE_DIR env variable if set
# Used when calling from faking-l4 notebook to specify where merged model goes
local_model_dir: "/kaggle/working/"

# Data source configuration
data:
  # Dataset source: "huggingface" or "database"  
  # If source is "database" or dataset_slug is null, will load from local.db
  source: "huggingface"  # can be overridden by DATA_SOURCE env variable
  
  # Database configuration (used when source is "database" or dataset_slug is null)
  database:
    path: "local.db"  # overridden by ARC_PROGRAMS_DB env variable if set
    table: "programs"
    # Filter for non-transductive programs (when loading from database)
    filters:
      is_transductive: false
      
  # HuggingFace dataset (used when source is "huggingface" and dataset_slug is provided)
  dataset_slug: "Trelis/arc-agi-1-perfect-50"

# Execution mode - controls checkpoint behavior
# "full": save all intermediate checkpoints and push to hub
# "final_only": only save and merge final checkpoint (used when called from faking-l4)
execution_mode: "full"  # overridden by FINE_TUNING_MODE env variable

# Model configuration
model:
  slug: "Qwen/Qwen3-4B"  # overridden by MODEL_SLUG env variable if set
  # Alternative models:
  # slug: "julien31/Soar-qwen-7b"
  # slug: "Qwen/Qwen2.5-Coder-7B-Instruct"
  # slug: "Qwen/Qwen3-30B-A3B"
  # slug: "Trelis/Qwen3-4B_ds-arc-agi-1-perfect-50-c642"  # pre-trained model example
  
  max_length: 32768  # Max eval set ~19,400 tokens + headroom
  lora_rank: 128

# Training configuration
training:
  batch_size_global: 4  # Can use 32 for Qwen3-4b
  max_rows: null  # Set to integer to limit training data, null for all
  enable_thinking: false  # Required for training qwen base model

# Override max_rows when in test mode
overrides:
  test_run_max_rows: 128  # 32*4 rows for test runs